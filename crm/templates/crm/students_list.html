{% extends 'crm/base.html' %}
{% block content %}

<div class="max-w-6xl mx-auto p-6">

    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800">Students</h2>
        <a href="{% url 'student_create' %}"
           class="px-4 py-2 bg-green-600 text-white rounded-lg shadow">
           + Add Student
        </a>
    </div>

    <!-- Filters -->
    <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <input
            type="text"
            name="q"
            placeholder="Search name, phone, email"
            value="{{ request.GET.q }}"
            class="border rounded-lg p-3 w-full bg-gray-50"
        />

        <select name="country" class="border rounded-lg p-3 bg-gray-50">
            <option value="">All Countries</option>
            {% for c in filter_form.fields.country.queryset %}
                <option value="{{ c.id }}"
                {% if request.GET.country == c.id|stringformat:'s' %}selected{% endif %}>
                    {{ c.name }}
                </option>
            {% endfor %}
        </select>

        <select name="archived" class="border rounded-lg p-3 bg-gray-50">
            <option value="">All</option>
            <option value="0" {% if request.GET.archived == '0' %}selected{% endif %}>Active</option>
            <option value="1" {% if request.GET.archived == '1' %}selected{% endif %}>Archived</option>
        </select>

        <div class="flex space-x-2">
            <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Filter</button>
            <a href="{% url 'students_list' %}"
               class="px-4 py-2 bg-gray-500 text-white rounded-lg">Reset</a>
        </div>
    </form>

    <!-- Table -->
    <div class="bg-white border rounded-xl shadow overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100 text-gray-700">
                <tr>
                    <th class="px-4 py-3 text-left">#</th>
                    <th class="px-4 py-3 text-left">Name</th>
                    <!-- Country column removed -->
                    <th class="px-4 py-3 text-left">Phone</th>
                    <th class="px-4 py-3 text-left">Email</th>
                    <th class="px-4 py-3 text-left">Course</th>
                    <th class="px-4 py-3 text-left">Status</th>
                    <th class="px-4 py-3 text-left">Enrollment</th>
                    <th class="px-4 py-3 text-right">Actions</th>
                </tr>
            </thead>

            <tbody class="divide-y">
                {% for s in students %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-gray-500">{{ s.id }}</td>

                    <td class="px-4 py-3 font-semibold">
                        {{ s.first_name }} {{ s.last_name }}
                    </td>

                    <!-- Country column removed -->

                    <td class="px-4 py-3">{{ s.phone|default:"—" }}</td>
                    <td class="px-4 py-3">{{ s.email|default:"—" }}</td>

                    <td class="px-4 py-3">
                        {% if s.course %}
                            <span class="px-2 py-1 rounded bg-indigo-600 text-white text-sm">
                                {{ s.course }}
                            </span>
                        {% else %}
                            <span class="text-gray-400">—</span>
                        {% endif %}
                    </td>

                    <td class="px-4 py-3">
                        {% if s.application_status == 'accepted' %}
                            <span class="px-2 py-1 rounded bg-green-600 text-white text-sm">Accepted</span>
                        {% elif s.application_status == 'pending' %}
                            <span class="px-2 py-1 rounded bg-yellow-400 text-black text-sm">Pending</span>
                        {% elif s.application_status == 'rejected' %}
                            <span class="px-2 py-1 rounded bg-red-600 text-white text-sm">Rejected</span>
                        {% else %}
                            <span class="px-2 py-1 rounded bg-gray-500 text-white text-sm">Unknown</span>
                        {% endif %}
                    </td>

                    <td class="px-4 py-3">
                        {% if s.enrollment_date %}
                            {{ s.enrollment_date|date:"M d, Y" }}
                        {% else %}
                            <span class="text-gray-400">—</span>
                        {% endif %}
                    </td>

                    <!-- Actions with icons side by side -->
                    <td class="px-4 py-3">
                        <div class="flex justify-end space-x-2">
                            <!-- View (eye icon) -->
                            <a href="{% url 'student_detail' s.id %}"
                               class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </a>

                            <!-- Edit (pencil icon) -->
                            <a href="{% url 'student_edit' s.id %}"
                               class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-50 text-gray-700 hover:bg-gray-100 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M16.862 4.487l1.651-1.651a1.875 1.875 0 112.652 2.652L8.25 18.403 4.5 19.5l1.097-3.75L16.862 4.487z" />
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M19.5 7.125L17.25 4.875" />
                                </svg>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="px-4 py-6 text-center text-gray-500">
                        No students found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

    <!-- Pagination -->
    <div class="mt-6 flex justify-center">
        <ul class="flex space-x-2">
            {% if students.has_previous %}
                <li><a class="px-3 py-1 border rounded" href="?page={{ students.previous_page_number }}">&laquo;</a></li>
            {% endif %}

            {% for p in students.paginator.page_range %}
                <li>
                    <a href="?page={{ p }}"
                       class="px-3 py-1 border rounded
                       {% if students.number == p %} bg-indigo-600 text-white {% endif %}">
                       {{ p }}
                    </a>
                </li>
            {% endfor %}

            {% if students.has_next %}
                <li><a class="px-3 py-1 border rounded" href="?page={{ students.next_page_number }}">&raquo;</a></li>
            {% endif %}
        </ul>
    </div>

</div>

{% endblock %}
