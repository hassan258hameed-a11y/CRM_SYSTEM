{% extends "crm/base.html" %}

{% block content %}
<div class="max-w-5xl mx-auto p-6">

    <!-- Page title -->
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Edit User</h2>

    <!-- Card -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">

        <!-- ONE form wrapping everything -->
        <form method="post" class="space-y-8">
            {% csrf_token %}

            <!-- BASIC INFORMATION -->
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <span class="w-3 h-3 border-2 border-gray-500 rounded-full mr-2"></span>
                    Basic Information
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Full Name (we reuse first_name for simplicity) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Full Name *
                        </label>
                        {{ form.first_name }}
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Email *
                        </label>
                        {{ form.email }}
                    </div>

                    <!-- Phone – UI only (not saved yet) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Phone
                        </label>
                        <input type="text"
                               name="phone"
                               class="w-full rounded-xl border border-gray-300 px-4 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="+1234567890">
                    </div>

                    <!-- Department – UI only (not saved yet) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Department
                        </label>
                        <input type="text"
                               name="department"
                               class="w-full rounded-xl border border-gray-300 px-4 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="Management, Admissions, Support...">
                    </div>
                </div>
            </div>

            <!-- ROLE AND STATUS -->
            <div class="pt-4 border-t border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    Role and Status
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Role (admin / manager / staff) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Role *
                        </label>
                        <select name="role"
                                class="w-full rounded-xl border border-gray-300 px-4 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            {% for value,label in form.fields.role.choices %}
                                <option value="{{ value }}"
                                    {% if form.role.value == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Status (active / inactive) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Status *
                        </label>
                        <select name="status"
                                class="w-full rounded-xl border border-gray-300 px-4 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="active" {% if current_status == "active" %}selected{% endif %}>Active</option>
                            <option value="inactive" {% if current_status == "inactive" %}selected{% endif %}>Inactive</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- PERMISSIONS -->
            <div class="pt-4 border-t border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    Permissions
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                    {% for label in perms %}
                    <label class="flex items-center justify-between border rounded-xl px-3 py-2 bg-gray-50 cursor-pointer hover:bg-purple-50">
                        <span>{{ label }}</span>
                        <input type="checkbox" name="perm_{{ label|lower }}"
                               class="h-4 w-4 text-purple-600 rounded focus:ring-purple-500">
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- ERROR BLOCK -->
            {% if form.errors %}
            <div class="p-4 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700">
                <p class="font-semibold mb-1">Please fix the errors below:</p>
                <ul class="list-disc ml-5 space-y-1">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li>
                                {% if field != '__all__' %}
                                    <strong>{{ field|capfirst }}:</strong>
                                {% endif %}
                                {{ error }}
                            </li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- BUTTONS -->
            <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                <a href="{% url 'manage_users' %}"
                   class="px-5 py-2 rounded-xl border border-gray-300 text-gray-700 text-sm hover:bg-gray-50">
                    Cancel
                </a>
                <button type="submit"
                        class="px-6 py-2 rounded-xl bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700 shadow">
                    Update User
                </button>
            </div>

        </form>
    </div>
</div>
{% endblock %}
